<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dieta do Costella — v10</title>
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM (development UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX transpile -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      /* Estilo de impressão: limpa fundos e garante boa legibilidade no PDF */
      @media print {
        footer { display: none !important; }
        .col-cat { display: none !important; }
        header, nav, .no-print {
          display: none !important;
        }
        body {
          background: #fff !important;
        }
        .card, .border, table, th, td {
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }
        .page-break {
          page-break-before: always;
        }
      }
    
      @page {
        size: A4;
        margin: 8mm;
      }
      @media print {
        footer { display: none !important; }
        .col-cat { display: none !important; }
        body { font-size: 11px; }
        table { font-size: 11px; }
        th, td { padding: 1px 3px !important; }
        .hide-in-print { display: none !important; }
        .col-categoria { display: none !important; }
        /* reduce gaps */
        .space-y-6 > * + * { margin-top: 0.5rem !important; }
        .p-4 { padding: 0.25rem !important; }
        .py-8 { padding-top: 1rem !important; padding-bottom: 1rem !important; }
        .px-4 { padding-left: 0.75rem !important; padding-right: 0.75rem !important; }
      }
    </style>
  </head>
  <body class="bg-white">
    <div id="root"></div>

    <script type="text/babel">
      const { useMemo, useState } = React;

      const round = (n) => Math.round(n * 10) / 10;

      const CAT = {
        PROTEINA: "Proteína",
        CARBO: "Carboidrato",
        GORDURA: "Gordura",
        FRUTA: "Fruta",
        LATICINIO: "Laticínio",
        LEGUME: "Legume/Vegetal",
        GRAO: "Grão/Leguminosa",
        SUPLEMENTO: "Suplemento",
      };

      const CAT_STYLE = {
        [CAT.PROTEINA]: "bg-emerald-50 text-emerald-700 border-emerald-200",
        [CAT.CARBO]: "bg-sky-50 text-sky-700 border-sky-200",
        [CAT.GORDURA]: "bg-amber-50 text-amber-700 border-amber-200",
        [CAT.FRUTA]: "bg-orange-50 text-orange-700 border-orange-200",
        [CAT.LATICINIO]: "bg-indigo-50 text-indigo-700 border-indigo-200",
        [CAT.LEGUME]: "bg-lime-50 text-lime-800 border-lime-200",
        [CAT.GRAO]: "bg-cyan-50 text-cyan-700 border-cyan-200",
        [CAT.SUPLEMENTO]: "bg-gray-100 text-gray-700 border-gray-200",
      };

      const ROW_ACCENT = {
        [CAT.PROTEINA]: "border-l-4 border-emerald-300 hover:bg-emerald-50",
        [CAT.CARBO]: "border-l-4 border-sky-300 hover:bg-sky-50",
        [CAT.GORDURA]: "border-l-4 border-amber-300 hover:bg-amber-50",
        [CAT.FRUTA]: "border-l-4 border-orange-300 hover:bg-orange-50",
        [CAT.LATICINIO]: "border-l-4 border-indigo-300 hover:bg-indigo-50",
        [CAT.LEGUME]: "border-l-4 border-lime-300 hover:bg-lime-50",
        [CAT.GRAO]: "border-l-4 border-cyan-300 hover:bg-cyan-50",
        [CAT.SUPLEMENTO]: "border-l-4 border-gray-300 hover:bg-gray-50",
      };

      const STAT_STYLE = {
        neutral: "bg-white border-gray-200 text-gray-800",
        kcal: "bg-sky-50 border-sky-200 text-sky-800",
        prot: "bg-emerald-50 border-emerald-200 text-emerald-800",
        carb: "bg-blue-50 border-blue-200 text-blue-800",
        gord: "bg-amber-50 border-amber-200 text-amber-800",
      };

      const makeItem = (name, qty, kcal, p, c, f, cat, note = "") => ({ name, qty, kcal, p, c, f, cat, note });

      function proteinItem(type) {
        switch (type) {
          case "carne":
            return makeItem("Carne vermelha magra", "150 g", 285, 31, 0, 18, CAT.PROTEINA);
          case "frango":
            return makeItem("Frango grelhado", "170 g", 265, 36, 0, 5, CAT.PROTEINA);
          case "peixe":
            return makeItem("Peixe branco grelhado", "190 g", 255, 38, 0, 4, CAT.PROTEINA);
          default:
            return makeItem("Carne vermelha magra", "150 g", 285, 31, 0, 18, CAT.PROTEINA);
        }
      }

      function buildAlmoco(type, isDescanso = false) {
        const arrozQtd = isDescanso ? 100 : 120;
        const arrozKcal = isDescanso ? 130 : 160;
        const arrozCarb = isDescanso ? 28 : 34;
        return [
          proteinItem(type),
          makeItem("Arroz branco", `${arrozQtd} g`, arrozKcal, 2.5, arrozCarb, 0.5, CAT.CARBO),
          makeItem("Feijão preto", "60 g", 80, 3.5, 12, 0.3, CAT.GRAO),
          makeItem("Salada crua (mix)", "150 g", 45, 1.5, 9, 0.2, CAT.LEGUME),
        ];
      }

      function buildJantar(type, isDescanso = false) {
        const arrozQtd = isDescanso ? 80 : 100;
        const arrozKcal = isDescanso ? 105 : 130;
        const arrozCarb = isDescanso ? 22 : 28;
        return [
          proteinItem(type),
          makeItem("Arroz branco", `${arrozQtd} g`, arrozKcal, 2.5, arrozCarb, 0.3, CAT.CARBO),
          makeItem("Abóbora cozida", "80 g", 35, 0.6, 8, 0, CAT.LEGUME),
          makeItem("Pasta de amendoim sem açúcar", "5 g", 45, 2, 1, 4, CAT.GORDURA),
          makeItem("Salada variada", "150 g", 25, 1, 4, 0, CAT.LEGUME),
        ];
      }

      const cafe = [
        makeItem("Mamão papaia", "80 g", 32, 0.3, 8, 0, CAT.FRUTA),
        makeItem("Iogurte zero", "100 ml", 35, 3, 3, 0, CAT.LATICINIO),
        makeItem("Aveia", "30 g", 112, 3.5, 19, 2, CAT.CARBO),
        makeItem("Granola", "15 g", 65, 1.5, 11, 2, CAT.CARBO),
        makeItem("Ovos inteiros", "2 un (100 g)", 140, 12.5, 0, 10, CAT.PROTEINA),
        makeItem("Pão francês", "60 g", 180, 4.8, 35.2, 1.9, CAT.CARBO),
        makeItem("Queijo muçarela", "25 g", 85, 6, 0, 7, CAT.LATICINIO),
        makeItem("Presunto magro", "40 g", 60, 7, 0, 2, CAT.PROTEINA),
      ];

      const lancheSanduiche = [
        makeItem("Pão francês", "60 g", 180, 4.8, 35.2, 1.9, CAT.CARBO),
        makeItem("Queijo muçarela", "25 g", 85, 6, 0, 7, CAT.LATICINIO),
        makeItem("Presunto magro", "40 g", 60, 7, 0, 2, CAT.PROTEINA),
      ];

      const preTreinoTreino = [
        makeItem("Whey protein", "30 g", 120, 24, 3, 1, CAT.SUPLEMENTO),
        makeItem("Creatina", "5 g", 0, 0, 0, 0, CAT.SUPLEMENTO),
        makeItem("Glutamina", "5 g", 20, 5, 0, 0, CAT.SUPLEMENTO),
        makeItem("Banana prata", "80 g", 72, 1, 18, 0, CAT.FRUTA),
      ];

      const preTreinoDescanso = [
        makeItem("Whey protein", "30 g", 120, 24, 3, 1, CAT.SUPLEMENTO),
        makeItem("Creatina", "5 g", 0, 0, 0, 0, CAT.SUPLEMENTO),
        makeItem("Glutamina", "5 g", 20, 5, 0, 0, CAT.SUPLEMENTO),
        makeItem("Banana prata", "50 g", 45, 0.6, 11, 0, CAT.FRUTA),
      ];

      function Stat({ label, value, tone = "neutral" }) {
        const toneCls = STAT_STYLE[tone] || STAT_STYLE.neutral;
        return (
          <div className={`rounded-2xl border p-4 shadow-sm ${toneCls}`}>
            <div className="text-xs opacity-80">{label}</div>
            <div className="text-xl font-semibold">{value}</div>
          </div>
        );
      }

      function Legend() {
        const entries = Object.values(CAT);
        return (
          <div className="flex flex-wrap gap-2 text-xs">
            {entries.map((cat) => (
              <span
                key={cat}
                className={`border px-2 py-1 rounded-full ${CAT_STYLE[cat]}`}
                title={cat}
              >
                {cat}
              </span>
            ))}
          </div>
        );
      }

      function Footer() {
        return (
          <footer className="max-w-5xl mx-auto px-4 py-10 text-sm text-gray-600">
            <div className="grid md:grid-cols-3 gap-6">
              <div>
                <div className="font-medium text-gray-800">Instruções</div>
                <ul className="mt-2 list-disc list-inside">
                  <li>Hidrate-se: 2,5–3 L/dia</li>
                  <li>Pré-Treino (18h): whey + creatina + glutamina + banana</li>
                  <li>Alergia: castanhas removidas; usar pasta de amendoim sem açúcar</li>
                  <li>Nos dias sem treino: banana 50 g e arroz −20 g por refeição com arroz</li>
                </ul>
              </div>
              <div>
                <div className="font-medium text-gray-800">Legenda de Cores</div>
                <div className="mt-2"><div className="print:hidden"><Legend /></div></div>
              </div>
            </div>
            <div className="mt-8 text-xs text-gray-500">Versão v10 – Dieta personalizada para Costella (TACO/USDA).</div>
          </footer>
        );
      }

      
      function MealCard({ name, items, forceOpen = false }) {
        const [open, setOpen] = useState(false);
        const actuallyOpen = open || forceOpen;
        const t = useMemo(() => items.reduce((acc, it) => ({
          kcal: acc.kcal + it.kcal,
          p: acc.p + it.p,
          c: acc.c + it.c,
          f: acc.f + it.f,
        }), { kcal: 0, p: 0, c: 0, f: 0 }), [items]);

        return (
          <div className="rounded-xl border bg-white shadow-md overflow-hidden">
            {/* Título clicável (oculto na impressão) */}
            <button
              className="w-full px-4 py-3 bg-slate-50 flex justify-between items-center hover:bg-slate-100 no-print"
              onClick={() => setOpen(!open)}
            >
              <span className="font-medium">{name}</span>
              <span className="text-sm text-gray-600">
                {Math.round(t.kcal)} kcal • P {round(t.p)}g • C {round(t.c)}g • G {round(t.f)}g
              </span>
            </button>

            {/* Cabeçalho somente para impressão */}
            <div className="hidden print:flex print:px-4 print:py-2 print:bg-white print:border-b">
              <span className="font-medium">{name}</span>
            </div>
            {(actuallyOpen) && (
              <div className="p-4 overflow-x-auto">
                <table className="min-w-full text-sm">
                  <thead>
                    <tr className="border-b text-gray-600">
                      <th className="py-1 text-left">Alimento</th>
                      <th className="py-1 text-left col-categoria">Categoria</th>
                      <th className="py-1 text-left">Quantidade</th>
                      <th className="py-1 text-left">kcal</th>
                      <th className="py-1 text-left">P</th>
                      <th className="py-1 text-left">C</th>
                      <th className="py-1 text-left">G</th>
                    </tr>
                  </thead>
                  <tbody>
                    {items.map((i, idx) => (
                      <tr key={idx} className={`border-b last:border-0 ${ROW_ACCENT[i.cat] || ''}`}>
                        <td className="py-1">{i.name}</td>
                        <td className="py-1 col-cat">
                          <span className={`border px-2 py-0.5 rounded-full text-[11px] ${CAT_STYLE[i.cat]}`}>{i.cat}</span>
                        </td>
                        <td className="py-1 whitespace-nowrap">{i.qty}</td>
                        <td className="py-1">{i.kcal}</td>
                        <td className="py-1">{i.p}</td>
                        <td className="py-1">{i.c}</td>
                        <td className="py-1">{i.f}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        );
      }
function DayPlan({ title, meals, forceOpen = false }) {
        const totals = useMemo(() => {
          const flat = Object.values(meals).flat();
          const t = flat.reduce(
            (acc, it) => ({
              kcal: acc.kcal + it.kcal,
              p: acc.p + it.p,
              c: acc.c + it.c,
              f: acc.f + it.f,
            }),
            { kcal: 0, p: 0, c: 0, f: 0 }
          );
          return { kcal: round(t.kcal), p: round(t.p), c: round(t.c), f: round(t.f) };
        }, [meals]);

        return (
          <section className="space-y-6">
            <div className="flex items-center justify-between gap-3">
              <h2 className="text-2xl font-semibold bg-clip-text text-transparent bg-gradient-to-r from-emerald-700 to-sky-700">{title}</h2>
              <div className="print:hidden"><Legend /></div>
            </div>

            {Object.entries(meals).map(([k, v]) => (
              <MealCard key={k} name={k} items={v} forceOpen={forceOpen} />
            ))}

            <div className="grid md:grid-cols-4 grid-cols-2 gap-3 hide-in-print">
              <Stat label="Total kcal" value={totals.kcal} tone="kcal" />
              <Stat label="Proteína (g)" value={totals.p} tone="prot" />
              <Stat label="Carbo (g)" value={totals.c} tone="carb" />
              <Stat label="Gordura (g)" value={totals.f} tone="gord" />
            </div>
          </section>
        );
      }

      function DietaCostellaSite() {
        const [activeTab, setActiveTab] = useState("treino");
        const [meatType, setMeatType] = useState("carne");
        const [forceOpen, setForceOpen] = useState(false);

        const treinoMeals = React.useMemo(() => ({
          "Café da manhã": cafe,
          "Almoço": buildAlmoco(meatType, false),
          "Lanche 16h": lancheSanduiche,
          "Pré-Treino (18h)": preTreinoTreino,
          "Jantar (pós-treino)": buildJantar(meatType, false),
        }), [meatType]);

        const descansoMeals = React.useMemo(() => ({
          "Café da manhã": cafe,
          "Almoço": buildAlmoco(meatType, true),
          "Lanche 16h": lancheSanduiche,
          "Pré-Treino (18h)": preTreinoDescanso,
          "Jantar": buildJantar(meatType, true),
        }), [meatType]);

        const handlePrint = () => {
          // abre todas as seções, troca para uma visualização estática e chama print
          setForceOpen(true);
          // dá tempo do React renderizar aberto
          setTimeout(() => {
            window.print();
            // após impressão, opcionalmente voltar ao estado anterior
            setTimeout(() => setForceOpen(false), 300);
          }, 150);
        };

        return (
          <div className="min-h-screen bg-gradient-to-b from-emerald-50 via-white to-sky-50 text-gray-900">
            <header className="sticky top-0 z-10 border-b border-emerald-200">
              <div className="bg-gradient-to-r from-emerald-600 to-sky-600 text-white">
                <div className="max-w-5xl mx-auto px-4 py-3 flex flex-wrap justify-between items-center gap-2">
                  <h1 className="text-lg font-semibold bg-clip-text text-white">Dieta do Costella</h1>
                  <div className="flex gap-2 items-center">
                    <label className="text-sm leading-none opacity-90">Proteína:</label>
                    <select
                      value={meatType}
                      onChange={(e) => setMeatType(e.target.value)}
                      className="border border-white/30 bg-white/10 text-white rounded-lg px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-white/50"
                    >
                      <option value="carne" className="text-gray-900">Carne vermelha (150 g)</option>
                      <option value="frango" className="text-gray-900">Frango (170 g)</option>
                      <option value="peixe" className="text-gray-900">Peixe (190 g)</option>
                    </select>
                  </div>
                  <nav className="flex gap-1">
                    <button
                      onClick={() => setActiveTab("treino")}
                      className={`px-3 py-1.5 rounded-lg border transition ${activeTab === "treino"
                        ? "bg-white text-emerald-700 border-white shadow"
                        : "bg-white/10 text-white border-white/30 hover:bg-white/20"
                      }`}
                    >
                      Dias de Treino
                    </button>
                    <button
                      onClick={() => setActiveTab("descanso")}
                      className={`px-3 py-1.5 rounded-lg border transition ${activeTab === "descanso"
                        ? "bg-white text-sky-700 border-white shadow"
                        : "bg-white/10 text-white border-white/30 hover:bg-white/20"
                      }`}
                    >
                      Dias Sem Treino
                    </button>
                  </nav>
                  <button
                    onClick={handlePrint}
                    className="no-print px-3 py-1.5 rounded-lg border border-white bg-white/10 hover:bg-white/20 text-white transition"
                    title="Abrir todas as seções e imprimir para PDF"
                  >
                    Imprimir PDF
                  </button>
                </div>
              </div>
            </header>

            <main className="max-w-5xl mx-auto px-4 py-8 space-y-8">
              {activeTab === "treino" ? (
                <DayPlan title="Plano – Dias de Treino" meals={treinoMeals} forceOpen={forceOpen} />
              ) : (
                <DayPlan title="Plano – Dias Sem Treino" meals={descansoMeals} forceOpen={forceOpen} />
              )}
            </main>

            <Footer />
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<DietaCostellaSite />);
    </script>
  </body>
</html>
